<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hyunhye.comment.repository.CommentRepository">

	<resultMap id="commentList" type="comment">
		<result property="userNo" column="user_no" />
		<result property="userId" column="user_id" />
		<result property="userName" column="user_name" />
		<result property="boardNo" column="board_no"/>
		<result property="commentNo" column="comment_no" />
		<result property="commentContent" column="comment_content" />
		<result property="commentDate" column="comment_date" />
		<result property="commentCount" column="comment_count" />
		<result property="commentParentNo" column="comment_parent_no" />
	</resultMap>
	
	<select id="commentCommentSelect" resultMap="commentList">
		SELECT 
			USER.user_name, 
			USER.user_id, 
			COMMENT.comment_no, 
			COMMENT.comment_content, 
			COMMENT.comment_date, 
			COMMENT.comment_parent_no
		FROM COMMENT
		JOIN  USER
		ON COMMENT.user_no = USER.user_no
		WHERE
			comment_parent_no = #{commentNo}
		ORDER BY comment_no
	</select>
	
	<select id="commentListAll" resultMap="commentList">
		SELECT 
			USER.user_name, 
			USER.user_id, 
			COMMENT.comment_no, 
			COMMENT.comment_content, 
			COMMENT.comment_date, 
			USER.user_name
		FROM COMMENT
		JOIN  USER
		ON COMMENT.user_no = USER.user_no
		WHERE 
			board_no = #{boardNo}
			AND
			comment_parent_no = 0
		ORDER BY comment_no
	</select>
	
	<insert id="commentRegist">
		INSERT INTO COMMENT (
			board_no, 
			user_no, 
			comment_content,
			comment_parent_no
		) VALUES (
			#{boardNo}, 
			#{userNo}, 
			#{commentContent},
			#{commentParentNo}
		)
	</insert>

	<select id="commentUpdate" resultMap="commentList">
		UPDATE COMMENT SET
			comment_content = #{commentContent}
		WHERE 
			comment_no = #{commentNo}
	</select>

	<delete id="commentDelete" parameterType="int"> 
		DELETE FROM COMMENT
		WHERE 
			comment_no = #{commentNo} 
	</delete>
	
	<select id="commentCount" resultMap="commentList">
		SELECT 
			board_no, 
			count(comment_no) as comment_count
		FROM COMMENT 
		group by board_no;
	</select>
	
	<select id="commentSelect" resultMap="commentList">
		SELECT 
			USER.user_name, 
			USER.user_id, 
			COMMENT.comment_no, 
			COMMENT.comment_content, 
			COMMENT.comment_date, 
			USER.user_name
		FROM COMMENT
		JOIN  USER
		ON COMMENT.user_no = USER.user_no
		WHERE 
			comment_no = #{commentNo}
	</select>
	
	<select id="commentLastSelect" resultMap="commentList">
		SELECT 
			USER.user_name, 
			USER.user_id, 
			COMMENT.comment_no, 
			COMMENT.comment_content, 
			COMMENT.comment_date, 
			USER.user_name
		FROM COMMENT
		JOIN  USER
		ON COMMENT.user_no = USER.user_no
		WHERE 
			comment_no = (SELECT comment_no FROM COMMENT ORDER BY comment_no desc LIMIT 1)
	</select>
</mapper>
